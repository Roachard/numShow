<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <title>Thorb 记忆训练</title>
    <link rel="shortcut icon" href="//static.smartisanos.cn/common/img/favicon.ico">
    <link rel="apple-touch-icon" href="//static.smartisanos.cn/common/img/favicon_114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="//static.smartisanos.cn/common/img/favicon_76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="//static.smartisanos.cn/common/img/favicon_120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="//static.smartisanos.cn/common/img/favicon_152.png">
    <style>
        .row h2 span:after{
            content:" ";
            display:inline;
        }
        img{
            transition:5s;
            z-index:10000;
            position: absolute;
            width:50%;
            height:100%;
        }
        #img-r{
            left:50%;
        }
        #img-l{
            left:0;
            transform:scaleX(-1);
        }
        body{
            overflow: hidden;
        }
    </style>
</head>
<body>
<img id="img-l" src="pic/r.jpg">
<img id="img-r" src="pic/r.jpg">
<div class="container">
    <h1 style="text-align: center;">Thorb 记忆训练</h1>
    <h2 id="here" class="row" style="text-align: center; margin: 0 20px;">

    </h2>
    <div class="row">
        <div class="col-md-4 jump" id="team1">
            <h2 class="row0">
                <small>1. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row1">
                <small>2. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row2">
                <small>3. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row3">
                <small>4. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row4">
                <small>5. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row5">
                <small>6. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row6">
                <small>7. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row7">
                <small>8. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row8">
                <small>9. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row9">
                <small>10.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row10">
                <small>11.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row11">
                <small>12.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row12">
                <small>13.</small><span></span><span></span>
            </h2>
        </div>
        <div class="col-md-4" id="team2">
            <h2 class="row0">
                <small>1. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row1">
                <small>2. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row2">
                <small>3. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row3">
                <small>4. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row4">
                <small>5. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row5">
                <small>6. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row6">
                <small>7. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row7">
                <small>8. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row8">
                <small>9. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row9">
                <small>10.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row10">
                <small>11.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row11">
                <small>12.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row12">
                <small>13.</small><span></span><span></span>
            </h2>
        </div>
        <div class="col-md-4" id="team3">
            <h2 class="row0">
                <small>1. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row1">
                <small>2. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row2">
                <small>3. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row3">
                <small>4. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row4">
                <small>5. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row5">
                <small>6. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row6">
                <small>7. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row7">
                <small>8. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row8">
                <small>9. </small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row9">
                <small>10.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row10">
                <small>11.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row11">
                <small>12.</small><span></span><span></span><span></span><span></span>
            </h2>
            <h2 class="row12">
                <small>13.</small><span></span><span></span>
            </h2>
        </div>
    </div>
    <h1 style="text-align: center;">
        <span id="timer">10分 0秒</span>
    </h1>
    <div class="button" style="text-align: center;">
        <button id="success" class="btn btn-success">开始</button>
        <button id="primary" class="btn btn-primary">刷新</button>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
<script
        src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/locale/zh-cn.js"></script>
<script>

    var timer = null;
    var stopped = false;
    var line = 0;
    var jumpDuration = 1500;
    var temp;
    var arr99={};
    var arr00={};
    var intervalHandler = 0,started = false;
    var startTime ={};
    var endTime = {};
    for(k=0;k<12;k++){
        arr99[k]=99;
    }
    for(k=0;k<12;k++){
        arr00[k]=0;
    }

    function generateNum(){
        var temp = {},k;
        for (k=0;k<12;k++){
            temp[k] = parseInt(Math.random()*100);
        }
        return temp;
    }
    function getNum(){
        var $row = $(".row"+line),output={},k;
        $row.find("span").each(function(index,element){
            output[index] = $(element).text() - 0;
        });
        return output;

    }

    function animate() {
        var randomNum={},row;
        for (var k=0; k<150; k++) {
            randomNum[k] = parseInt(Math.random()*100);
        }
        for (row = 0;row <= 12 ;row ++){
            if(row>=line){
                $(".row"+row)
                    .find("span")
                    .each(function(index,span){
                        temp = randomNum[index + (row * 12)];
                        $(span).text(temp>=10?temp:"0"+temp);
                })
            }
        }
        TWEEN.update();
        requestAnimationFrame(animate)
    }

    document.getElementById('success').onclick = function () {
        if(!started){
            intervalHandler = setInterval(function(){
                if(line>12){
                    clearInterval(intervalHandler);
                }
                nextLine(line);
            },100);
            endTime = (new moment).add(10,'minute');
            timer = setInterval(function(){
                var timeLeft = endTime.diff(new moment)/1000;
                if(timeLeft>0){
                    var min = Math.floor(timeLeft / 60);
                    var sec = Math.floor(timeLeft - 60*min);
                    $("#timer").text( min+"分 "+sec+"秒");
                }
                if(!stopped && timeLeft<0){
                    $("#timer").text("时间到！");
                    closeDoor();
                }
            })



        }
        started = true;


    };

    document.getElementById('primary').onclick = function clear () {
        document.location.reload();
    };


    function nextLine(prevLine){
        var rows = getNum();
        var to = generateNum();
        var jump00to99 = new TWEEN.Tween(Object.assign({},arr00))
            .easing(TWEEN.Easing.Linear.None)
            .to(Object.assign({},arr99),350)
            .onUpdate(function () {
                var context = this;
                $(".row"+prevLine)
                    .find("span")
                    .each(function(index,span){
                        temp = context[index].toFixed(0);
                        $(span).text(temp>=10?temp:"0"+temp);
                    })
            });
        var jump99 = new TWEEN.Tween(rows)
            .easing(TWEEN.Easing.Linear.None)
            .to(Object.assign({},arr99),350)
            .onUpdate(function () {
                var context = this;
                $(".row"+prevLine)
                    .find("span")
                    .each(function(index,span){
                        temp = context[index].toFixed(0);
                        $(span).text(temp>=10?temp:"0"+temp);
                    })
            });
        var goFinal = new TWEEN.Tween(Object.assign({},arr00))
            .easing(TWEEN.Easing.Quadratic.Out)
            .to(to, jumpDuration)
            .onUpdate(function () {
                var context = this;
                $(".row"+prevLine)
                    .find("span")
                    .each(function(index,span){
                        temp = context[index].toFixed(0);
                        $(span).text(temp>=10?temp:"0"+temp);
                    })
            });
        jump99.chain(goFinal);
        jump99.start();
        if (line <=12 ){
            $("h2").css("background-color","transparent");
            $(".row"+line).css("background-color","yellow");
            line ++;
        }

    }
    animate();
    setTimeout(function(){
        $("#img-l").css("left","-50%");
        $("#img-r").css("left","100%");
    },1000);
    function closeDoor(){
        stopped = true;
        setTimeout(function(){
            $("#img-l").css("left","0");
            $("#img-r").css("left","50%");
        },0);
    }
</script>
</body>
</html>
